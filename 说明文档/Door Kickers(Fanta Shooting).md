# Door Kickers(Fanta Shooting)

[TOC]

## 前言

本游戏的灵感来自于Door Kickers，但是由于世界线的变动最终游戏模式变成了Fanta Shooting，我们真的没有参考Fanta Shooting 呀（哭）

## 背景

你是五道口男子魔法学校的一名学生，已经到了大四并保研的你不甘心在学校里养老，决定去探索一下地牢，不得不说你的胆子是非常的大，成天的上课玩手机考试周突击课业导致你目前只能熟练使用两门法术：基础魔法火球术(Fireball)，撩妹必备陨石术(Meteor)。其他的魔法你在考完的当天就全部忘记了。你一路有惊无险地到达了一处地牢，发现这里隐藏着能够直接让你发顶会的一篇paper，不是，能够让你功力大涨的魔法水晶。不过你在发现魔法水晶的时候，来自隔壁的几个兄弟学校圆明园男女混合魔法学校，预备炼器法师培训学院等等学校的学生也发现了这个魔法水晶，一场大战即将打响。不过你丝毫不担心被他们揍死，毕竟哪个魔法学徒出门历练前不把复活术固化到自己身上呢。

## 游戏介绍

本游戏是即时对战类游戏，即你写的ai需要根据当前的局面做出一定的决策，为了给予选手充分的时间进行决策的思考，我们做出如下两点改动

1. 每一秒有`frames_per_second`帧，该常数值小于24，因此，观看的ai对决的replay视频渲染时间要大于实际时长
2. 我们保证提供给选手的地图信息是在传递参数时最新的参数，但是选手不一定要每一帧都做出及时的反馈，我们只会在指定的时间处监听选手的决策，若选手没有及时传递回决策，按照未做出任何决策处理。支持选手花费超过一帧的时间做出一次决策，但是在同一帧的时间内做出多次决策以最后一次为准

初始时，生成一张大小为`width_of_screen*height_of_screen`的地牢，里面有不超过`max_num_of_wall`堵墙，每堵墙都是一个四条边与边界平行的矩形，两两不相交，且墙不会导致地图上非墙部分不连通。每个选手都可以看做是地图中半径为`human_radius`的圆形，魔法水晶可以看做是半径为`ball_radius`的圆形，每个人的出生/复活的位置保证不会与墙或是魔法水晶所在位置相交，魔法水晶随地图一起随机生成，保证魔法水晶不与墙相交。每局游戏存在一定的限定时间，即经过`time_of_game`帧之后游戏就会结束，每个选手的得分为该选手持有魔法水晶的总时间。开始时，魔法水晶不归任何人持有，游戏的目标即为尽快持有魔法水晶并存活更长的时间，拾取魔法水晶的方式为人与无主的魔法水晶发生接触。当魔法水晶被一个人持有，其他人无法通过拾取的方式获得，魔法水晶会随着持有人的移动而移动，会在死亡时掉落在持有人死亡的位置。

每个选手在复活/出生后血量为`human_hp`，所有冷却时间清零，陨石术使用次数恢复最大值，选手与选手互相攻击的方式有以下两种途径：

1. 火球术：在选手正前方生成一个火球，该火球半径为`fireball_radius`，向前以每帧`velocity_of_fireball`的移动速度飞去，在碰到墙/地图边界/人的时候才会消失，若因碰到人消失，会造成半径为`splash_radius`(略大于`fireball_radius`)范围内的伤害`fireball_hurt`。火球不可以连发，有`human_fireball_interval`的冷却帧数限制。
2. 陨石术：指定半径`cast_distance`内一点(可以为墙或是边界外)，放置一个陨石轰击指示物，经过`meteor_delay`的帧数之后，天降一颗陨石，对半径为`explode_radius`内所有选手造成`explode_hurt`的伤害。陨石术不可以连发，有`human_meteor_interval`的冷却帧数限制，陨石术不能无限次发射，每人每次出生/复活后可以使用`human_meteor_number`次陨石术。

注意，两种攻击方式的使用的冷却时间条为同一时间条，即攻击之后会有冷却时间，但两种攻击方式的冷却时间不一样

当玩家死亡后，会经过`time_of_death`的时间才能在地图上随机位置处以满血无冷却满陨石术的状态复活。

以下表格详细解释了地图上所有物体发生接触(相交)的规则，注意边界处看做围了一层墙

|          | 选手     | 火球                         | 魔法水晶           | 墙                                             |
| -------- | -------- | ---------------------------- | ------------------ | ---------------------------------------------- |
| 选手     | 互不影响 | 火球消失，攻击范围内选手受伤 | 无主魔法水晶被拾起 | 不可相交，作出该移动决策不合法，按照未移动处理 |
| 火球     |          | 互不影响                     | 互不影响           | 火球消失，不发生伤害                           |
| 魔法水晶 |          |                              | 全局唯一魔法水晶   | 不可相交，保证生成水晶位置合法                 |
| 墙       |          |                              |                    | 保证墙的矩形之间不相交                         |



## AI决策

每一次(不一定每一帧都要返回即时决策)AI可以作出以下几种决策中的一种

1. `(opt=1,x,y)` AI移动到`(x,y)` 位置，要求`0<=dis(now_pos,(x,y))<=human_speed_max`，且直线移动过去不会与墙体发生碰撞
2. `(opt=2,rot,0)` AI旋转`rot`角度，要求`abs(rot)<=human_rotate_max`，这里我们使用360度的制度来表示朝向，即当前朝向与x轴正半轴的夹角，范围在0~360度之间。
3. `(opt=3,0,0)` 发射一颗火球
4. `(opt=4,x,y)` 在`(x,y)`处使用陨石术

## SDK接口

拷贝自swx(暗牙)的readme，不懂的请在群里狠戳他

### 文件说明

- **const.h**:常数都在这里。
- **geometry.h & geometry.cpp**:可能用到的计算几何库。
- **logic.h & logic.cpp**:游戏数据类，具体结合游戏说明望文生义即可。其中Logic类中储存了所有需要的数据，使用Logic::Instance()获取单例Logic类指针。
- **playerAI.h & playerAI.cpp**:选手需要完成playerAI函数，函数中通过修改参数ope完成你本帧的操作。具体操作约定见协议约定。
- **main.cpp**:负责网络收发，选手可以忽略这个文件。

### 编译说明

直接make即可，生成可执行文件main.exe。

## 调试方式

请联系frh(a little fine)

